<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>SSLè¯ä¹¦ä¿¡ä»»æŒ‡å—</title>
    <style>
        body { 
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif; 
            max-width: 800px; 
            margin: 0 auto; 
            padding: 20px; 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            min-height: 100vh;
        }
        .container {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.3);
        }
        .step {
            background: rgba(255, 255, 255, 0.1);
            padding: 20px;
            margin: 15px 0;
            border-radius: 10px;
            border-left: 4px solid #ffc107;
        }
        .success { border-left-color: #28a745; }
        .warning { border-left-color: #ffc107; }
        .error { border-left-color: #dc3545; }
        .info { border-left-color: #17a2b8; }
        
        button { 
            padding: 12px 24px; 
            margin: 8px; 
            border: none; 
            border-radius: 8px; 
            cursor: pointer; 
            font-weight: bold;
            transition: all 0.3s ease;
        }
        .btn-primary { background: #007bff; color: white; }
        .btn-success { background: #28a745; color: white; }
        .btn-warning { background: #ffc107; color: #212529; }
        
        code {
            background: rgba(0,0,0,0.3);
            padding: 2px 6px;
            border-radius: 4px;
            font-family: monospace;
        }
        
        .browser-specific {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        
        .browser-card {
            background: rgba(255,255,255,0.1);
            padding: 15px;
            border-radius: 10px;
            text-align: center;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ”’ SSLè¯ä¹¦ä¿¡ä»»æŒ‡å—</h1>
        
        <div class="step warning">
            <h3>âš ï¸ ä¸ºä»€ä¹ˆéœ€è¦ä¿¡ä»»è¯ä¹¦ï¼Ÿ</h3>
            <p>MQTTXå¯ä»¥å…³é—­SSLè¯ä¹¦éªŒè¯ï¼Œä½†æµè§ˆå™¨ä¸ºäº†å®‰å…¨å¿…é¡»éªŒè¯è¯ä¹¦ã€‚</p>
            <p>æˆ‘ä»¬çš„MQTTæœåŠ¡å™¨ä½¿ç”¨è‡ªç­¾åè¯ä¹¦ï¼Œéœ€è¦æ‰‹åŠ¨ä¿¡ä»»ã€‚</p>
        </div>

        <div class="step info">
            <h3>ğŸ¯ ç›®æ ‡æœåŠ¡å™¨</h3>
            <p><strong>WSSåœ°å€:</strong> <code>wss://117.72.196.137:8084/mqtt</code></p>
            <p><strong>HTTPSåœ°å€:</strong> <code>https://117.72.196.137:8084</code></p>
        </div>

        <div class="step">
            <h3>ğŸ“‹ é€šç”¨æ­¥éª¤</h3>
            <ol>
                <li>ç‚¹å‡»ä¸‹é¢çš„"è®¿é—®HTTPSåœ°å€"æŒ‰é’®</li>
                <li>æµè§ˆå™¨ä¼šæ˜¾ç¤º"ä¸å®‰å…¨"æˆ–"è¯ä¹¦é”™è¯¯"è­¦å‘Š</li>
                <li>ç‚¹å‡»"é«˜çº§"æˆ–"Advanced"</li>
                <li>ç‚¹å‡»"ç»§ç»­è®¿é—®"æˆ–"Proceed to 117.72.196.137"</li>
                <li>çœ‹åˆ°é¡µé¢å†…å®¹åï¼Œè¯ä¹¦å·²è¢«ä¿¡ä»»</li>
                <li>è¿”å›MQTTæµ‹è¯•é¡µé¢ï¼Œé‡æ–°æµ‹è¯•WSSè¿æ¥</li>
            </ol>
        </div>

        <div style="text-align: center; margin: 30px 0;">
            <button class="btn-warning" onclick="openCertificatePage()">ğŸ”’ è®¿é—®HTTPSåœ°å€ä¿¡ä»»è¯ä¹¦</button>
            <button class="btn-success" onclick="testWSS()">ğŸ§ª æµ‹è¯•WSSè¿æ¥</button>
            <button class="btn-primary" onclick="goBack()">ğŸ”™ è¿”å›æµ‹è¯•é¡µé¢</button>
        </div>

        <div class="browser-specific">
            <div class="browser-card">
                <h4>ğŸŒ Chrome</h4>
                <p>æ˜¾ç¤º"æ‚¨çš„è¿æ¥ä¸æ˜¯ç§å¯†è¿æ¥"</p>
                <p>ç‚¹å‡»"é«˜çº§" â†’ "ç»§ç»­å‰å¾€117.72.196.137"</p>
            </div>
            
            <div class="browser-card">
                <h4>ğŸ¦Š Firefox</h4>
                <p>æ˜¾ç¤º"è­¦å‘Šï¼šæ½œåœ¨çš„å®‰å…¨é£é™©"</p>
                <p>ç‚¹å‡»"é«˜çº§" â†’ "æ¥å—é£é™©å¹¶ç»§ç»­"</p>
            </div>
            
            <div class="browser-card">
                <h4>ğŸ§­ Safari</h4>
                <p>æ˜¾ç¤º"æ­¤è¿æ¥ä¸æ˜¯ç§äººè¿æ¥"</p>
                <p>ç‚¹å‡»"æ˜¾ç¤ºè¯¦ç»†ä¿¡æ¯" â†’ "è®¿é—®æ­¤ç½‘ç«™"</p>
            </div>
            
            <div class="browser-card">
                <h4>ğŸŒŠ Edge</h4>
                <p>æ˜¾ç¤º"æ‚¨çš„è¿æ¥ä¸æ˜¯ç§å¯†è¿æ¥"</p>
                <p>ç‚¹å‡»"é«˜çº§" â†’ "ç»§ç»­åˆ°117.72.196.137"</p>
            </div>
        </div>

        <div class="step success" id="status" style="display: none;">
            <h3>âœ… è¯ä¹¦ä¿¡ä»»çŠ¶æ€</h3>
            <p id="statusText">æ­£åœ¨æ£€æµ‹...</p>
        </div>

        <div class="step info">
            <h3>ğŸ” éªŒè¯æ–¹æ³•</h3>
            <p>ä¿¡ä»»è¯ä¹¦åï¼Œä½ å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼éªŒè¯ï¼š</p>
            <ul>
                <li>è®¿é—® <code>https://117.72.196.137:8084</code> ä¸å†æ˜¾ç¤ºè­¦å‘Š</li>
                <li>WSSè¿æ¥æµ‹è¯•æˆåŠŸ</li>
                <li>æµè§ˆå™¨åœ°å€æ æ˜¾ç¤ºé”å›¾æ ‡ï¼ˆå¯èƒ½å¸¦è­¦å‘Šï¼‰</li>
            </ul>
        </div>

        <div class="step warning">
            <h3>ğŸ›¡ï¸ å®‰å…¨è¯´æ˜</h3>
            <p><strong>æ³¨æ„ï¼š</strong>è¿™ç§æ–¹æ³•ä»…é€‚ç”¨äºå¼€å‘å’Œæµ‹è¯•ç¯å¢ƒã€‚</p>
            <p>ç”Ÿäº§ç¯å¢ƒå»ºè®®ä½¿ç”¨æœ‰æ•ˆçš„SSLè¯ä¹¦ã€‚</p>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/mqtt@4.3.7/dist/mqtt.min.js"></script>
    <script>
        function openCertificatePage() {
            const certUrl = 'https://117.72.196.137:8084';
            const certWindow = window.open(certUrl, '_blank', 'width=800,height=600');
            
            showStatus('ğŸ”„ è¯·åœ¨æ–°çª—å£ä¸­ä¿¡ä»»è¯ä¹¦...', 'info');
            
            // æ£€æµ‹çª—å£å…³é—­
            const checkClosed = setInterval(() => {
                if (certWindow.closed) {
                    clearInterval(checkClosed);
                    showStatus('âœ… è¯ä¹¦ä¿¡ä»»çª—å£å·²å…³é—­ï¼Œè¯·æµ‹è¯•WSSè¿æ¥', 'success');
                    
                    // å»¶è¿Ÿæµ‹è¯•è¯ä¹¦æ˜¯å¦å·²ä¿¡ä»»
                    setTimeout(checkCertificateTrust, 2000);
                }
            }, 1000);
        }
        
        function checkCertificateTrust() {
            showStatus('ğŸ” æ£€æµ‹è¯ä¹¦ä¿¡ä»»çŠ¶æ€...', 'info');
            
            // å°è¯•è®¿é—®HTTPSåœ°å€æ£€æµ‹è¯ä¹¦çŠ¶æ€
            fetch('https://117.72.196.137:8084/', { 
                mode: 'no-cors',
                cache: 'no-cache'
            })
            .then(() => {
                showStatus('âœ… è¯ä¹¦å·²ä¿¡ä»»ï¼ç°åœ¨å¯ä»¥ä½¿ç”¨WSSè¿æ¥äº†', 'success');
            })
            .catch(error => {
                if (error.message.includes('certificate') || error.message.includes('SSL')) {
                    showStatus('âŒ è¯ä¹¦å°šæœªä¿¡ä»»ï¼Œè¯·é‡æ–°å°è¯•ä¿¡ä»»æ­¥éª¤', 'error');
                } else {
                    showStatus('âœ… è¯ä¹¦å¯èƒ½å·²ä¿¡ä»»ï¼ˆç½‘ç»œé”™è¯¯ä¸å½±å“WSSè¿æ¥ï¼‰', 'success');
                }
            });
        }
        
        function testWSS() {
            showStatus('ğŸ§ª æµ‹è¯•WSSè¿æ¥...', 'info');
            
            try {
                const client = mqtt.connect('wss://117.72.196.137:8084/mqtt', {
                    clientId: 'cert_test_' + Math.random().toString(16).substr(2, 8),
                    clean: true,
                    connectTimeout: 10000,
                    reconnectPeriod: 0
                });
                
                const timeout = setTimeout(() => {
                    showStatus('âŒ WSSè¿æ¥è¶…æ—¶ï¼Œè¯·ç¡®è®¤è¯ä¹¦å·²ä¿¡ä»»', 'error');
                    client.end();
                }, 10000);
                
                client.on('connect', () => {
                    clearTimeout(timeout);
                    showStatus('ğŸ‰ WSSè¿æ¥æˆåŠŸï¼è¯ä¹¦ä¿¡ä»»å®Œæˆ', 'success');
                    client.end();
                });
                
                client.on('error', (error) => {
                    clearTimeout(timeout);
                    if (error.message.includes('certificate') || error.message.includes('SSL')) {
                        showStatus('âŒ WSSè¿æ¥å¤±è´¥ï¼šè¯ä¹¦é—®é¢˜ï¼Œè¯·é‡æ–°ä¿¡ä»»è¯ä¹¦', 'error');
                    } else {
                        showStatus(`âŒ WSSè¿æ¥å¤±è´¥ï¼š${error.message}`, 'error');
                    }
                });
                
            } catch (error) {
                showStatus(`âŒ WSSæµ‹è¯•å¼‚å¸¸ï¼š${error.message}`, 'error');
            }
        }
        
        function showStatus(message, type) {
            const statusDiv = document.getElementById('status');
            const statusText = document.getElementById('statusText');
            
            statusDiv.style.display = 'block';
            statusDiv.className = `step ${type}`;
            statusText.textContent = message;
        }
        
        function goBack() {
            if (window.opener) {
                window.close();
            } else {
                window.location.href = 'vercel_mqtt_test.html';
            }
        }
        
        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨æ£€æµ‹è¯ä¹¦çŠ¶æ€
        window.addEventListener('load', () => {
            setTimeout(checkCertificateTrust, 1000);
        });
    </script>
</body>
</html>
