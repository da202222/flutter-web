<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>æ··åˆå†…å®¹é—®é¢˜è§£å†³æ–¹æ¡ˆ</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", "Microsoft YaHei", sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
            line-height: 1.6;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .alert {
            padding: 15px;
            margin: 20px 0;
            border-radius: 4px;
            border-left: 4px solid;
        }
        .alert-warning {
            background-color: #fff3cd;
            border-color: #ffc107;
            color: #856404;
        }
        .alert-info {
            background-color: #d1ecf1;
            border-color: #17a2b8;
            color: #0c5460;
        }
        .alert-success {
            background-color: #d4edda;
            border-color: #28a745;
            color: #155724;
        }
        .solution {
            background: #f8f9fa;
            padding: 20px;
            margin: 15px 0;
            border-radius: 4px;
            border: 1px solid #dee2e6;
        }
        .solution h3 {
            margin-top: 0;
            color: #495057;
        }
        .steps {
            margin: 10px 0;
            padding-left: 20px;
        }
        .steps li {
            margin: 8px 0;
        }
        button {
            padding: 12px 24px;
            margin: 8px 4px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            font-weight: bold;
            text-decoration: none;
            display: inline-block;
        }
        .btn-primary { background-color: #007bff; color: white; }
        .btn-success { background-color: #28a745; color: white; }
        .btn-warning { background-color: #ffc107; color: #212529; }
        .browser-specific {
            display: none;
            margin-top: 15px;
        }
        .browser-tabs {
            display: flex;
            margin-bottom: 15px;
        }
        .browser-tab {
            padding: 10px 20px;
            background: #e9ecef;
            border: 1px solid #dee2e6;
            cursor: pointer;
            margin-right: 5px;
        }
        .browser-tab.active {
            background: #007bff;
            color: white;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ”’ æ··åˆå†…å®¹é—®é¢˜è§£å†³æ–¹æ¡ˆ</h1>
        
        <div class="alert alert-warning">
            <strong>âš ï¸ æ£€æµ‹åˆ°æ··åˆå†…å®¹é”™è¯¯</strong><br>
            æ‚¨çš„åº”ç”¨é€šè¿‡HTTPSè®¿é—®ï¼Œä½†å°è¯•è¿æ¥åˆ°ä¸å®‰å…¨çš„WebSocketç«¯ç‚¹ (ws://)ã€‚
            æµè§ˆå™¨çš„å®‰å…¨ç­–ç•¥é˜»æ­¢äº†è¿™ç§è¿æ¥ã€‚
        </div>

        <div class="alert alert-info">
            <strong>ğŸ“‹ é—®é¢˜è¯´æ˜</strong><br>
            å½“ç½‘é¡µé€šè¿‡HTTPSåŠ è½½æ—¶ï¼Œæµè§ˆå™¨è¦æ±‚æ‰€æœ‰èµ„æºï¼ˆåŒ…æ‹¬WebSocketè¿æ¥ï¼‰ä¹Ÿå¿…é¡»ä½¿ç”¨å®‰å…¨åè®®ã€‚
            è¿™æ˜¯ä¸ºäº†ä¿æŠ¤ç”¨æˆ·æ•°æ®å®‰å…¨çš„é‡è¦å®‰å…¨æœºåˆ¶ã€‚
        </div>

        <h2>ğŸ› ï¸ è§£å†³æ–¹æ¡ˆ</h2>

        <div class="solution">
            <h3>æ–¹æ¡ˆ1: å…è®¸ä¸å®‰å…¨å†…å®¹ (ä¸´æ—¶è§£å†³)</h3>
            <p>åœ¨å½“å‰é¡µé¢ä¸´æ—¶å…è®¸æ··åˆå†…å®¹ï¼š</p>
            
            <div class="browser-tabs">
                <div class="browser-tab active" onclick="showBrowser('chrome')">Chrome</div>
                <div class="browser-tab" onclick="showBrowser('firefox')">Firefox</div>
                <div class="browser-tab" onclick="showBrowser('safari')">Safari</div>
                <div class="browser-tab" onclick="showBrowser('edge')">Edge</div>
            </div>

            <div id="chrome" class="browser-specific" style="display: block;">
                <ol class="steps">
                    <li>ç‚¹å‡»åœ°å€æ å³ä¾§çš„ ğŸ›¡ï¸ (ç›¾ç‰Œ) å›¾æ ‡</li>
                    <li>é€‰æ‹© "åŠ è½½ä¸å®‰å…¨è„šæœ¬" æˆ– "å…è®¸ä¸å®‰å…¨å†…å®¹"</li>
                    <li>é¡µé¢ä¼šè‡ªåŠ¨åˆ·æ–°ï¼ŒMQTTè¿æ¥åº”è¯¥èƒ½æ­£å¸¸å·¥ä½œ</li>
                </ol>
            </div>

            <div id="firefox" class="browser-specific">
                <ol class="steps">
                    <li>ç‚¹å‡»åœ°å€æ å·¦ä¾§çš„ ğŸ”’ (é”) å›¾æ ‡</li>
                    <li>ç‚¹å‡» "è¿æ¥ä¸å®‰å…¨"</li>
                    <li>é€‰æ‹© "ç¦ç”¨æ­¤ä¼šè¯çš„ä¿æŠ¤"</li>
                    <li>åˆ·æ–°é¡µé¢</li>
                </ol>
            </div>

            <div id="safari" class="browser-specific">
                <ol class="steps">
                    <li>Safariå¯¹æ··åˆå†…å®¹è¾ƒä¸ºä¸¥æ ¼</li>
                    <li>å»ºè®®ä½¿ç”¨å…¶ä»–æµè§ˆå™¨æˆ–HTTPç‰ˆæœ¬</li>
                    <li>æˆ–è€…åœ¨Safariè®¾ç½®ä¸­è°ƒæ•´å®‰å…¨é€‰é¡¹</li>
                </ol>
            </div>

            <div id="edge" class="browser-specific">
                <ol class="steps">
                    <li>ç‚¹å‡»åœ°å€æ å³ä¾§çš„ ğŸ›¡ï¸ å›¾æ ‡</li>
                    <li>é€‰æ‹© "å…³é—­æ­¤é¡µé¢çš„ä¿æŠ¤"</li>
                    <li>ç¡®è®¤å¹¶åˆ·æ–°é¡µé¢</li>
                </ol>
            </div>
        </div>

        <div class="solution">
            <h3>æ–¹æ¡ˆ2: ä½¿ç”¨HTTPç‰ˆæœ¬ (æ¨èæµ‹è¯•)</h3>
            <p>åœ¨æœ¬åœ°ç¯å¢ƒä½¿ç”¨HTTPç‰ˆæœ¬ï¼Œé¿å…æ··åˆå†…å®¹é™åˆ¶ï¼š</p>
            <ol class="steps">
                <li>åœ¨æœ¬åœ°è¿è¡Œ: <code>flutter run -d chrome --web-port=8080</code></li>
                <li>è®¿é—®: <code>http://localhost:8080</code></li>
                <li>HTTPç¯å¢ƒä¸‹å¯ä»¥æ­£å¸¸ä½¿ç”¨WSè¿æ¥</li>
            </ol>
            <a href="http://localhost:8080" class="btn-primary" target="_blank">æ‰“å¼€HTTPç‰ˆæœ¬</a>
        </div>

        <div class="solution">
            <h3>æ–¹æ¡ˆ3: é…ç½®WSSæœåŠ¡å™¨ (æ°¸ä¹…è§£å†³)</h3>
            <p>åœ¨EMQXæœåŠ¡å™¨ä¸Šå¯ç”¨WSSæ”¯æŒï¼š</p>
            <ol class="steps">
                <li>ä¸ºæœåŠ¡å™¨é…ç½®SSLè¯ä¹¦</li>
                <li>å¯ç”¨EMQXçš„WSSç›‘å¬å™¨ (ç«¯å£8084)</li>
                <li>æ›´æ–°åº”ç”¨é…ç½®ä½¿ç”¨WSSè¿æ¥</li>
                <li>é‡æ–°éƒ¨ç½²åº”ç”¨</li>
            </ol>
            <p><strong>è¯¦ç»†æ­¥éª¤è¯·å‚è€ƒ:</strong> EMQX_WSSé…ç½®å®Œæ•´æŒ‡å—.md</p>
        </div>

        <div class="solution">
            <h3>æ–¹æ¡ˆ4: ä½¿ç”¨ä»£ç†æœåŠ¡</h3>
            <p>é€šè¿‡HTTPSä»£ç†è½¬å‘WebSocketè¿æ¥ï¼š</p>
            <ol class="steps">
                <li>éƒ¨ç½²WebSocketä»£ç†æœåŠ¡</li>
                <li>ä»£ç†æœåŠ¡æä¾›WSSæ¥å£</li>
                <li>è½¬å‘åˆ°åç«¯WSæœåŠ¡å™¨</li>
                <li>æ›´æ–°åº”ç”¨é…ç½®ä½¿ç”¨ä»£ç†</li>
            </ol>
        </div>

        <h2>ğŸ§ª æµ‹è¯•è¿æ¥</h2>
        
        <div style="margin: 20px 0;">
            <a href="/" class="btn-success">è¿”å›ä¸»åº”ç”¨</a>
            <a href="/mqtt_test.html" class="btn-primary">MQTTè¿æ¥æµ‹è¯•</a>
            <button class="btn-warning" onclick="testConnection()">å¿«é€Ÿè¿æ¥æµ‹è¯•</button>
        </div>

        <div class="alert alert-success" style="display: none;" id="testResult">
            <strong>âœ… è¿æ¥æµ‹è¯•ç»“æœå°†æ˜¾ç¤ºåœ¨è¿™é‡Œ</strong>
        </div>

        <h2>ğŸ“ éœ€è¦å¸®åŠ©ï¼Ÿ</h2>
        <p>å¦‚æœä»¥ä¸Šæ–¹æ¡ˆéƒ½æ— æ³•è§£å†³é—®é¢˜ï¼Œè¯·ï¼š</p>
        <ul>
            <li>æ£€æŸ¥ç½‘ç»œè¿æ¥å’Œé˜²ç«å¢™è®¾ç½®</li>
            <li>ç¡®è®¤MQTTæœåŠ¡å™¨çŠ¶æ€</li>
            <li>å°è¯•ä¸åŒçš„æµè§ˆå™¨</li>
            <li>è”ç³»æŠ€æœ¯æ”¯æŒ</li>
        </ul>
    </div>

    <script>
        function showBrowser(browser) {
            // éšè—æ‰€æœ‰æµè§ˆå™¨è¯´æ˜
            const browsers = ['chrome', 'firefox', 'safari', 'edge'];
            browsers.forEach(b => {
                document.getElementById(b).style.display = 'none';
                document.querySelector(`[onclick="showBrowser('${b}')"]`).classList.remove('active');
            });
            
            // æ˜¾ç¤ºé€‰ä¸­çš„æµè§ˆå™¨è¯´æ˜
            document.getElementById(browser).style.display = 'block';
            document.querySelector(`[onclick="showBrowser('${browser}')"]`).classList.add('active');
        }

        function testConnection() {
            const resultDiv = document.getElementById('testResult');
            resultDiv.style.display = 'block';
            resultDiv.innerHTML = '<strong>ğŸ”„ æ­£åœ¨æµ‹è¯•è¿æ¥...</strong>';
            
            // ç®€å•çš„è¿æ¥æµ‹è¯•
            try {
                const ws = new WebSocket('ws://117.72.196.137:8083/mqtt');
                
                ws.onopen = function() {
                    resultDiv.innerHTML = '<strong>âœ… è¿æ¥æˆåŠŸï¼</strong><br>WebSocketè¿æ¥å·²å»ºç«‹ï¼ŒMQTTåº”è¯¥èƒ½æ­£å¸¸å·¥ä½œã€‚';
                    resultDiv.className = 'alert alert-success';
                    ws.close();
                };
                
                ws.onerror = function(error) {
                    resultDiv.innerHTML = '<strong>âŒ è¿æ¥å¤±è´¥</strong><br>ä»ç„¶å­˜åœ¨æ··åˆå†…å®¹é™åˆ¶ï¼Œè¯·å°è¯•ä¸Šè¿°è§£å†³æ–¹æ¡ˆã€‚';
                    resultDiv.className = 'alert alert-warning';
                };
                
                // è¶…æ—¶å¤„ç†
                setTimeout(() => {
                    if (ws.readyState === WebSocket.CONNECTING) {
                        ws.close();
                        resultDiv.innerHTML = '<strong>â° è¿æ¥è¶…æ—¶</strong><br>å¯èƒ½æ˜¯ç½‘ç»œé—®é¢˜æˆ–æœåŠ¡å™¨ä¸å¯è¾¾ã€‚';
                        resultDiv.className = 'alert alert-warning';
                    }
                }, 5000);
                
            } catch (error) {
                resultDiv.innerHTML = '<strong>âŒ æµ‹è¯•å¤±è´¥</strong><br>' + error.message;
                resultDiv.className = 'alert alert-warning';
            }
        }

        // æ£€æµ‹å½“å‰æµè§ˆå™¨å¹¶è‡ªåŠ¨é€‰æ‹©å¯¹åº”æ ‡ç­¾
        function detectBrowser() {
            const userAgent = navigator.userAgent;
            if (userAgent.includes('Chrome') && !userAgent.includes('Edge')) {
                showBrowser('chrome');
            } else if (userAgent.includes('Firefox')) {
                showBrowser('firefox');
            } else if (userAgent.includes('Safari') && !userAgent.includes('Chrome')) {
                showBrowser('safari');
            } else if (userAgent.includes('Edge')) {
                showBrowser('edge');
            }
        }

        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨æ£€æµ‹æµè§ˆå™¨
        window.addEventListener('load', detectBrowser);
    </script>
</body>
</html>
